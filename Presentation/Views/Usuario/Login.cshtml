@model Application.DTOs.Usuarios.Request.LoginDto
@{
    ViewData["Title"] = "Iniciar Sesión";
    Layout = "_AuthLayout";
    var domain = ViewData["Domain"] as string ?? "@psm.edu.ve";
    var emailDomain = ViewData["EmailDomain"] as string ?? "@psm.edu.ve";
}

<form asp-action="Login" method="post" class="mt-0" id="loginForm">
    @Html.AntiForgeryToken()

    <div class="mb-4">
        <h4 class="fw-semibold mb-1">Inicia sesión</h4>
        <p class="text-muted small mb-0">Accede a tu cuenta de Biblioteca Universitaria.</p>
        <p class="text-muted small mb-0">Solo se permite el dominio <strong>@emailDomain</strong></p>
    </div>

    <div class="mb-3">
        <label for="Usuario" class="form-label small text-muted text-uppercase fw-semibold">Correo Institucional</label>
        <div class="input-group has-validation">
            <span class="input-group-text bg-transparent border-end-0">
                <i class="fas fa-envelope text-muted"></i>
            </span>
            <input type="text"
                   class="form-control border-start-0"
                   id="Usuario"
                   name="Usuario"
                   placeholder="ejemplo: luedardo.rondon"
                   autocomplete="username"
                   required
                   maxlength="100"
                   title="Ingresa solo el nombre de usuario (ej: luedardo.rondon)">
            <span class="input-group-text bg-transparent border-start-0 text-muted user-select-none" id="domainSuffix">@emailDomain</span>
            
            <!-- Campo oculto para enviar el correo completo al servidor -->
            <input type="hidden" id="Correo" name="Correo" value="">
            
            <div id="usuarioFeedback" class="invalid-feedback">
                Por favor ingresa tu nombre de usuario institucional
            </div>
        </div>
        <span class="form-text small text-muted">Ingresa solo tu nombre de usuario institucional (sin @emailDomain)</span>
    </div>
    
    <div class="mb-3">
        <label for="Contrasena" class="form-label small text-muted text-uppercase fw-semibold">Contraseña</label>
        <div class="input-group">
            <span class="input-group-text bg-transparent border-end-0">
                <i class="fas fa-lock text-muted"></i>
            </span>
            <input type="password" 
                   class="form-control border-start-0" 
                   id="Contrasena" 
                   name="Contrasena" 
                   placeholder="••••••••"
                   autocomplete="current-password"
                   required>
            <button class="btn btn-outline-secondary border-start-0" type="button" id="togglePassword">
                <i class="fas fa-eye"></i>
            </button>
        </div>
    </div>
    
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="form-check mb-0">
            <input type="checkbox" class="form-check-input" id="RememberMe" name="RememberMe">
            <label class="form-check-label small" for="RememberMe">Recordar sesión</label>
        </div>
        <a href="/usuario/recuperacion" class="login-link small">¿Olvidaste tu contraseña?</a>
    </div>
    
    <button type="submit" class="btn btn-primary w-100 py-2 mb-3">
        <i class="fas fa-arrow-right-to-bracket me-2"></i> Entrar
    </button>
    
    <div class="text-center">
        <p class="text-muted mb-2">¿Eres nuevo en la biblioteca?</p>
        <a asp-controller="Registro" asp-action="crear" class="btn btn-outline-primary w-100">
            <i class="fas fa-user-plus me-2"></i> Registrarse
        </a>
    </div>
</form>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const domainElement = document.getElementById('domainSuffix');
            const DOMAIN = domainElement ? domainElement.textContent.trim() : @ViewData["Domain"];
            console.log("Dominio detectado:", DOMAIN);

            const usuarioInput = document.getElementById('Usuario');
            const correoHiddenInput = document.getElementById('Correo');
            const contrasenaInput = document.getElementById('Contrasena');
            const togglePasswordBtn = document.getElementById('togglePassword');
            const loginForm = document.getElementById('loginForm');
            const usuarioFeedback = document.getElementById('usuarioFeedback');

             // Verificar que los elementos existen
            if (!usuarioInput) {
                console.error("❌ No se encontró el elemento #Usuario");
                return;
            }
            if (!correoHiddenInput) {
                console.error("❌ No se encontró el elemento #Correo (hidden)");
                return;
            }

            console.log("✅ Elementos encontrados correctamente");


        }
    </script>
}